
version: 2

models:
  - name: scribe_organizations_day
    description: |
      Table with one record per organization and per month after their billing
      start date

    columns:
      - name: date_day
        tests:
          - not_null

      - name: organization_id
        tests:
          - not_null

      - name: organization_name
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_day, organization_id)"

  - name: scribe_contract_organizations_daily
    columns:
      - name: date_month
        tests:
          - not_null

      - name: date_day
        tests:
          - not_null

      - name: organization_id
        tests:
          - not_null

      - name: organization_name
        tests:
          - not_null

      - name: active_contracts
        tests:
          - not_null

      - name: is_paid
        tests:
          - not_null

      - name: billing_start_date
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_day, organization_id)"

  - name: scribe_contract_organizations_monthly
    columns:
      - name: date_month
        tests:
          - not_null

      - name: organization_id
        tests:
          - not_null

      - name: organization_name
        tests:
          - not_null

      - name: active_contracts
        tests:
          - not_null

      - name: min_active_contracts
        tests:
          - not_null

      - name: max_active_contracts
        tests:
          - not_null

      - name: price_monthly
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_month, organization_id)"

  - name: scribe_contract_organizations_monthly
    columns:
      - name: date_month
        tests:
          - not_null
          - unique

      - name: active_contracts
        tests:
          - not_null

  - name: scribe_active_contracts_monthly
    columns:
      - name: date_month
        tests:
          - not_null
          - unique

      - name: active_contracts
        tests:
          - not_null

      - name: active_contracts_paid
        tests:
          - not_null

      - name: active_contracts_unpaid
        tests:
          - not_null

  - name: scribe_contracts_daily
    columns:
      - name: date_day
        tests:
          - not_null
          - unique

      - name: contract_count
        tests:
          - not_null

      - name: contract_paid_count
        tests:
          - not_null

  - name: scribe_contracts_weekly
    columns:
      - name: date_week
        tests:
          - not_null
          - unique

      - name: contract_count
        tests:
          - not_null

      - name: contract_paid_count
        tests:
          - not_null

  - name: scribe_organization_province_split
    description: |
      Ratio of signed up users per province by organization

    columns:
      - name: organization_id
        tests:
          - not_null
          - unique

      - name: qc_perc
        tests:
          - not_null

      - name: on_perc
        tests:
          - not_null

      - name: roc_perc
        tests:
          - not_null

  - name: scribe_organizations_daily
    description: |
      Number of daily active contracts by organization

    columns:
      - name: date_day
        tests:
          - not_null

      - name: organization_id
        tests:
          - not_null

      - name: active_contracts
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_day, organization_id)"

  - name: scribe_organizations_weekly
    description: |
      Number of weekly active contracts by organization

    columns:
      - name: date_week
        tests:
          - not_null

      - name: organization_id
        tests:
          - not_null

      - name: active_contracts
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_week, organization_id)"

  - name: scribe_organization_mrr_by_province_weekly
    description: |
      Estimated split of MRR by province by organization
      Estimate is based on percentage of signup by province per organization

    columns:
      - name: date_week
        tests:
          - not_null

      - name: mrr_qc
        tests:
          - not_null

      - name: mrr_on
        tests:
          - not_null

      - name: mrr_roc
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_week, organization_id)"

  - name: scribe_organizations_active_today
    columns:
      - name: organization_id
        tests:
          - not_null
          - unique

      - name: organization_name
        tests:
          - not_null

      - name: email_preference
        tests:
          - not_null
          - accepted_values:
              values: ['english', 'french', 'bilingual-french-english',
                'bilingual-english-french']

      - name: is_paid
        tests:
          - not_null

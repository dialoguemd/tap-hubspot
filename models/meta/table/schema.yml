
version: 2

models:
  - name: meta_organizations
    columns:
      - name: organization_id
        tests:
          - not_null
          - unique

      - name: organization_name
        tests:
          - not_null

      - name: account_id
        tests:
          - not_null

      - name: account_name
        tests:
          - not_null

      - name: account_industry
        tests:
          - not_null

  - name: meta_accounts_monthly
    columns:
      - name: account_id
        tests:
          - not_null

      - name: account_name
        tests:
          - not_null

      - name: active_contracts
        tests:
          - not_null

      - name: price_monthly
        tests:
          - not_null

      - name: active_contracts_last_month
        tests:
          - not_null

      - name: price_monthly_last_month
        tests:
          - not_null

    tests:
      - unique:
          column_name: "concat(date_month, account_id)"

  - name: episodes
    description: A table containing episodes with details for analysis

    columns:
        - name: episode_id
          description: This is a unique identifier for the episode
          tests:
              - unique
              - not_null
    tests:
      - dbt_utils.recency:
          field: created_at
          datepart: day
          interval: 1


  - name: cp_activity
    description: A table containing activities completed by practitioners in
      the Care Platform as estimated by `page` and `video` events

    columns:
        - name: time_spent
          tests:
              - not_null
        - name: user_id
          tests:
              - not_null
    tests:
      - dbt_utils.recency:
          field: activity_start
          datepart: day
          interval: 1


  - name: cp_activity_detailed
    description: CP Activity but with additional analytical details from
      episodes

    columns:
        - name: time_spent
          tests:
              - not_null
    tests:
      - dbt_utils.recency:
          field: activity_start
          datepart: day
          interval: 1

  - name: chats_all_time
    description: A table containing daily episode activity with details about
      what activity was done in that episode on that day

    columns:
        - name: channel_id
          tests:
              - not_null
    tests:
      - dbt_utils.recency:
          field: created_at_day
          datepart: day
          interval: 1

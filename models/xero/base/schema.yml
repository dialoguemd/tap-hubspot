
version: 2

models:
  - name: xero_expenses
    description: 'Xero expenses going in the P&L report'

  - name: eae_compensation_percentage_monthly
    description: |
      Monthly percentage of account executive total compensation
      associated to the enterprise segment

      source: https://docs.google.com/spreadsheets/d/1vbG8wVFAjIiqeWeiJJhpvIDf2YfpCnQljYE7PRuT0tw/edit#gid=623385007

    columns:
      - name: date_month
        tests:
          - not_null
          - unique

      - name: eae_compensation_percentage
        tests:
          - not_null

  - name: xero_account_budget_categories
    description: |
      Mapping between Xero account categories and budget categories

      source: https://docs.google.com/spreadsheets/d/1-pD13TVWXX2jLITIpZWLZrkA8IL9SAYFcHnoquK3P8g/edit?ts=5be35814#gid=30023288

    columns:
      - name: xero_account_name
        tests:
          - not_null
          - unique

      - name: account_budget_category
        tests:
          - not_null

  - name: xero_budget_monthly
    description: |
      Monthly budget by account

      source: https://docs.google.com/spreadsheets/d/1-pD13TVWXX2jLITIpZWLZrkA8IL9SAYFcHnoquK3P8g/edit?ts=5be35814#gid=0

    columns:
      - name: date_month
        tests:
          - not_null

      - name: account_budget_category
        tests:
          - not_null

      - name: amount
        tests:
          - not_null

    tests:
        - unique:
            column_name: "concat(date_month, account_budget_category)"

  - name: xero_budget_departments
    description: |
      Mapping between budget categories and company departments

    columns:
      - name: account_budget_category
        tests:
          - not_null
          - unique

      - name: budget_department
        tests:
          - not_null

  - name: xero_invoices
    columns:
      - name: invoice_id
        tests:
          - not_null
          - unique
      - name: status
        tests:
          - not_null
          - accepted_values:
              values: ['DRAFT', 'PAID', 'VOIDED', 'DELETED', 'AUTHORISED']
      - name: invoice_type
        tests:
          - not_null
          - accepted_values:
              values: ['ACCREC', 'ACCPAY']
      - name: line_amount_types
        tests:
          - not_null
          - accepted_values:
              values: ['NoTax', 'Inclusive', 'Exclusive']

  - name: xero_invoices_line_items
    columns:
      - name: invoice_id
        tests:
          - not_null
          - relationships:
              to: ref('xero_invoices')
              field: invoice_id
      - name: account_code
        tests:
          - relationships:
              to: ref('xero_accounts')
              field: account_code

  - name: xero_manual_journals
    columns:
      - name: manual_journal_id
        tests:
          - not_null
          - unique
      - name: status
        tests:
          - not_null
          - accepted_values:
              values: ['POSTED', 'VOIDED']
      - name: line_amount_types
        tests:
          - not_null
          - accepted_values:
              values: ['NoTax', 'Inclusive', 'Exclusive']

  - name: xero_manual_journals_journal_lines
    columns:
      - name: manual_journal_id
        tests:
          - not_null
          - relationships:
              to: ref('xero_manual_journals')
              field: manual_journal_id
      - name: account_code
        tests:
          - not_null
          - relationships:
              to: ref('xero_accounts')
              field: account_code

  - name: xero_bank_transactions
    columns:
      - name: bank_transaction_id
        tests:
          - not_null
          - unique
      - name: bank_transaction_type
        tests:
          - not_null
          - accepted_values:
              values: ['RECEIVE', 'SPEND', 'RECEIVE-TRANSFER',
                'RECEIVE-OVERPAYMENT', 'SPEND-OVERPAYMENT', 'SPEND-TRANSFER']
      - name: line_amount_types
        tests:
          - not_null
          - accepted_values:
              values: ['NoTax', 'Inclusive', 'Exclusive']
      - name: line_amount
          - not_null
      - name: tax_amount
          - not_null
      - name: status
        tests:
          - not_null
          - accepted_values:
              values: ['DELETED', 'AUTHORISED']

  - name: xero_bank_transactions_line_items
    columns:
      - name: line_item_id
        tests:
          - not_null
          - unique
      - name: bank_transaction_id
        tests:
          - not_null
          - relationships:
              to: ref('xero_bank_transactions')
              field: bank_transaction_id
      - name: account_code
        tests:
          - relationships:
              to: ref('xero_accounts')
              field: account_code

  - name: xero_payments
    columns:
      - name: payment_id
        tests:
          - unique
          - not_null
      - name: payment_type
        tests:
          - not_null
          - accepted_values:
              values: ['ACCPAYPAYMENT', 'ACCRECPAYMENT']
      - name: status
        tests:
          - not_null
          - accepted_values:
              values: ['AUTHORISED', 'DELETED']
      - name: account_code
        tests:
          - relationships:
              to: ref('xero_accounts')
              field: account_code

  - name: xero_accounts
    columns:
      - name: account_id
        tests:
          - not_null
          - unique
      - name: account_code
        tests:
          - unique
      - name: account_name
        tests:
          - not_null
          - unique
